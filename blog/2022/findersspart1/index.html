<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Ananya Nandy | 3D point cloud alignment with optimal transport</title> <meta name="author" content="Ananya Nandy"> <meta name="description" content="Part I of technical concepts learned for data-driven design"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@/dist/css/bootstrap.min.css" rel="stylesheet" integrity="" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@/css/mdb.min.css" integrity="" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@/css/all.min.css" integrity="" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@/css/academicons.min.css" integrity="" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/.css" media="none" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/face-logo.png"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://ananyan.github.io/blog/2022/findersspart1/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="https://ananyan.github.io/"><span class="font-weight-bold">Ananya</span> Nandy</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/assets/pdf/AnanyaNandy_CV_0125.pdf">cv</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog</a> </li> <div class="toggle-container"> <a id="light-toggle"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </a> </div> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">3D point cloud alignment with optimal transport</h1> <p class="post-meta">July 30, 2022</p> <p class="post-tags"> <a href="/blog/2022"> <i class="fas fa-calendar fa-sm"></i> 2022 </a> </p> </header> <article class="post-content"> <p><strong>What was the Frontiers in Design Representation Summer School (FinDeR)?</strong> Hosted by Prof. Mark Fuge at UMD College Park, it was a week long “summer school” where graduate students (including me) came together to learn and discuss how we represent design data for computation. The topics specific to this year’s summer school were optimal transport, information geometry, and generative models (e.g., VAEs, GANs). These topics were introduced in the context of how they may apply to data-driven design. </p> <hr> <h2 id="motivation">Motivation</h2> <p>I wanted to try techniques for working with 3D data since I know it is difficult to work with, yet much of design data is encoded into 3D objects such as CAD models or physical artifacts. One of the challenge problems was to try to match aorta scans between patients at different time points (younger and older) which seemed like a challenging but interesting task. Furthermore, this challenge did not have much data (only 8 .stl files) associated with it, allowing me to see how techniques might work in the face of limited data. I knew that it would not be possible to use what I had learned about generative models such as GANs with this amount of data. Furthermore, the techniques I learned from information geometry would be difficult to apply since they require knowing and being able to specify the manifold the data lies on. Thus, what I learned about optimal transport was a good option to try on this data.</p> <div class="row justify-content-sm-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source media="(max-width: 480px)" srcset="/assets/img/Blog/FinderPart1/aortapointcloudgraphs-480.webp"></source> <source media="(max-width: 800px)" srcset="/assets/img/Blog/FinderPart1/aortapointcloudgraphs-800.webp"></source> <source media="(max-width: 1400px)" srcset="/assets/img/Blog/FinderPart1/aortapointcloudgraphs-1400.webp"></source> <img class="img-fluid" src="/assets/img/Blog/FinderPart1/aortapointcloudgraphs.jpg" alt="Visual of the eight point clouds of patient aortas as described in the motivation and data sections"> </picture> </figure> </div> </div> <div class="caption"> <i>Aorta point clouds in no particular order.</i> </div> <h2 id="data">Data</h2> <p>Each aorta was converted to a point cloud using the open3d library and 1000 points sampled from the .stl file. Initially, I did not apply any preprocessing to the point clouds. However, as I worked on the problem, I determined that certain preprocessing methods such as global registration could probably improve the results. My teammates and I realized (at the very end) that we likely needed to apply scaling as well.</p> <h2 id="optimal-transport">Optimal Transport</h2> <p>This concept was introduced to us by Dr. Jean Feydy in the context of ways to transform points from source to target. More broadly, optimal transport is essentially a generalization of sorting to dimensions that are greater than one. It can be used, for example, to find the distance between unordered point clouds where you do not know the mapping between the points. To implement this idea in the context of the aorta 3D scans, I used the tutorial notebook provided by Dr. Feydy (available at <a href="https://www.jeanfeydy.com/research.html" rel="external nofollow noopener" target="_blank">here</a> under Talks: Frontiers in Design Representation, University of Maryland) that demonstrated optimal transport in 2D, and extended it to 3D. When applying the concept of optimal transport, the loss was defined as follows:</p> <div class="row justify-content-sm-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source media="(max-width: 480px)" srcset="/assets/img/Blog/FinderPart1/otlossequation-480.webp"></source> <source media="(max-width: 800px)" srcset="/assets/img/Blog/FinderPart1/otlossequation-800.webp"></source> <source media="(max-width: 1400px)" srcset="/assets/img/Blog/FinderPart1/otlossequation-1400.webp"></source> <img class="img-fluid" src="/assets/img/Blog/FinderPart1/otlossequation.jpg" alt="Loss(x_1 to x_n; y_1 to y_n) = 1 divided by 2 times N multiplied by the minimum over permutations sigma of the sum, from i=1 to N, of the squared distances between x_i and y_sigma(i) "> </picture> </figure> </div> </div> <div class="caption"> <i>OT loss as defined in Dr. Feydy's tutorial. Not my image.</i> </div> <p>Notably, the Wasserstein distance is the square root of OT(A,B). Then, optimization needs to be performed to minimize this loss. This optimization can be conducted using gradient descent on the loss with respect to the features on the source object. In the tutorial, Dr. Feydy introduces the Sinkhorn algorithm, which I do not understand that well yet, within the optimization loop. Initially, I used the xyz-coordinates of the point cloud as the features (as an extension of the tutorial), despite knowing that it may not be the best representation for the structure of the aorta. The cost function in this case is the squared distance between the points of the two point clouds. Notably, optimal transport currently only works well for these types of simple cost functions since the pairwise costs between points have to be calculated.</p> <div class="row justify-content-sm-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source media="(max-width: 480px)" srcset="/assets/img/Blog/FinderPart1/otoptimization-480.webp"></source> <source media="(max-width: 800px)" srcset="/assets/img/Blog/FinderPart1/otoptimization-800.webp"></source> <source media="(max-width: 1400px)" srcset="/assets/img/Blog/FinderPart1/otoptimization-1400.webp"></source> <img class="img-fluid" src="/assets/img/Blog/FinderPart1/otoptimization.jpg" alt="visual of the movement of source points to target points between two aortas over timesteps 0, 0.25, 0.5, 1, 2, and 5"> </picture> </figure> </div> </div> <div class="caption"> <i>Visualization of the optimization over several timesteps to find the best mapping between points of two different point clouds.</i> </div> <h2 id="outcome">Outcome</h2> <p>Since the 3D .stl files were available, a visual inspection could be performed to qualitatively assign each aorta to its respective pair, though the ground truth was initially unknown.</p> <div class="row justify-content-sm-center"> <div class="col-sm-10 mt-3 mt-md-0"> <figure> <picture> <source media="(max-width: 480px)" srcset="/assets/img/Blog/FinderPart1/pairedaortas-480.webp"></source> <source media="(max-width: 800px)" srcset="/assets/img/Blog/FinderPart1/pairedaortas-800.webp"></source> <source media="(max-width: 1400px)" srcset="/assets/img/Blog/FinderPart1/pairedaortas-1400.webp"></source> <img class="img-fluid" src="/assets/img/Blog/FinderPart1/pairedaortas.jpg" alt="3d models of aortas sorted by visually assessed pairs: 2 &amp; 5, 4 &amp; 1, 8 &amp; 7, 6 &amp; 3, where the second aorta is the smaller one"> </picture> </figure> </div> <div class="col-sm-2 mt-3 mt-md-0"> <figure> <picture> <source media="(max-width: 480px)" srcset="/assets/img/Blog/FinderPart1/aortaexample-480.webp"></source> <source media="(max-width: 800px)" srcset="/assets/img/Blog/FinderPart1/aortaexample-800.webp"></source> <source media="(max-width: 1400px)" srcset="/assets/img/Blog/FinderPart1/aortaexample-1400.webp"></source> <img class="img-fluid" src="/assets/img/Blog/FinderPart1/aortaexample.jpg" alt="higher resolution aorta point cloud in rainbow colors"> </picture> </figure> </div> </div> <div class="caption"> <i>Left: The aorta .stl files paired according to patient based on our qualitative assessment. Right: an example of an aorta as a point cloud visualization from open3d. Not my images: both images were generated by fellow summer school attendees Leah (Michigan State) and Connor (UMD College Park), who I had several discussions with to tackle this challenge problem.</i> </div> <p>Then, the optimal transport loss was minimized over 100 time steps for each pair of aortas as the 1000-point point cloud as mentioned above. Below is a visualization of the optimal transport loss after 20 iterations. When the source and target were switched, the loss values were actually different (the optimization ended with a different permutation of points being mapped to each other). This is something I would have to investigate further to understand its impact on results.</p> <div class="row justify-content-sm-center"> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source media="(max-width: 480px)" srcset="/assets/img/Blog/FinderPart1/otloss_noregistration-480.webp"></source> <source media="(max-width: 800px)" srcset="/assets/img/Blog/FinderPart1/otloss_noregistration-800.webp"></source> <source media="(max-width: 1400px)" srcset="/assets/img/Blog/FinderPart1/otloss_noregistration-1400.webp"></source> <img class="img-fluid" src="/assets/img/Blog/FinderPart1/otloss_noregistration.jpg" alt="full confusion matrix"> </picture> </figure> </div> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source media="(max-width: 480px)" srcset="/assets/img/Blog/FinderPart1/otloss_noregistration_tri-480.webp"></source> <source media="(max-width: 800px)" srcset="/assets/img/Blog/FinderPart1/otloss_noregistration_tri-800.webp"></source> <source media="(max-width: 1400px)" srcset="/assets/img/Blog/FinderPart1/otloss_noregistration_tri-1400.webp"></source> <img class="img-fluid" src="/assets/img/Blog/FinderPart1/otloss_noregistration_tri.jpg" alt="lower triangle confusion matrix"> </picture> </figure> </div> </div> <div class="caption"> <i>Left: Optimal transport loss values for initial point clouds with xyz-coordinates as features. The only pair that minimizes loss in a way that appears to match our visual assessment is 7 and 8 (unfortunately, labeled 6 and 7 here due to 0-indexing). Right: Just the lower triangle of the left image for easier visualization.</i> </div> <p>I then realized that some of the aortas were not aligned in 3D space, which is a problem for calculating a distance with xyz-coordinates as features. Dr. Feydy also noted that optimal transport does not generally work well if the distances are very large. To fix this issue, I decided to use open3d to perform global registration on the point clouds. This global registration is determined using fast point feature histograms, which are essentially features of each point based on its geometric neighbors. These features are matched to determine a transformation from source to target that aligns the point clouds.</p> <div class="row justify-content-sm-center"> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source media="(max-width: 480px)" srcset="/assets/img/Blog/FinderPart1/pcd_noreg-480.webp"></source> <source media="(max-width: 800px)" srcset="/assets/img/Blog/FinderPart1/pcd_noreg-800.webp"></source> <source media="(max-width: 1400px)" srcset="/assets/img/Blog/FinderPart1/pcd_noreg-1400.webp"></source> <img class="img-fluid" src="/assets/img/Blog/FinderPart1/pcd_noreg.jpg" alt="two unaligned aorta point clouds"> </picture> </figure> </div> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source media="(max-width: 480px)" srcset="/assets/img/Blog/FinderPart1/pcd_reg-480.webp"></source> <source media="(max-width: 800px)" srcset="/assets/img/Blog/FinderPart1/pcd_reg-800.webp"></source> <source media="(max-width: 1400px)" srcset="/assets/img/Blog/FinderPart1/pcd_reg-1400.webp"></source> <img class="img-fluid" src="/assets/img/Blog/FinderPart1/pcd_reg.jpg" alt="the same aorta point clouds aligned"> </picture> </figure> </div> </div> <p>Again, the optimal transport loss was minimized and visualized, this time with the xyz-coordinates of the globally registered point clouds as features.</p> <div class="row justify-content-sm-center"> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source media="(max-width: 480px)" srcset="/assets/img/Blog/FinderPart1/otloss_reg-480.webp"></source> <source media="(max-width: 800px)" srcset="/assets/img/Blog/FinderPart1/otloss_reg-800.webp"></source> <source media="(max-width: 1400px)" srcset="/assets/img/Blog/FinderPart1/otloss_reg-1400.webp"></source> <img class="img-fluid" src="/assets/img/Blog/FinderPart1/otloss_reg.jpg" alt="full confusion matrix"> </picture> </figure> </div> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source media="(max-width: 480px)" srcset="/assets/img/Blog/FinderPart1/otloss_reg_tri-480.webp"></source> <source media="(max-width: 800px)" srcset="/assets/img/Blog/FinderPart1/otloss_reg_tri-800.webp"></source> <source media="(max-width: 1400px)" srcset="/assets/img/Blog/FinderPart1/otloss_reg_tri-1400.webp"></source> <img class="img-fluid" src="/assets/img/Blog/FinderPart1/otloss_reg_tri.jpg" alt="lower triangle confusion matrix"> </picture> </figure> </div> </div> <div class="caption"> <i>Left: Optimal transport loss values for globally registered point clouds with xyz-coordinates as features. The only pair that minimizes loss in a way that appears to match our visual assessment is 3 and 6 (unfortunately, labeled 2 and 5 here due to 0-indexing). Right: Just the lower triangle of the left image for easier visualization.</i> </div> <p>Finally, I attempted to address the issue of scaling by applying the iterative closest point (ICP) registration in open3d to get another transformation that includes scaling. The ICP algorithm requires an initial registration, which is satisfied by the transformation matrix obtained from global registration. However, this did not appear to make a difference in the optimal transport results.</p> <p>Compared to our group’s qualitative assessment of which aortas looked like they would be paired, the results only corroborated one pair (7 &amp; 8) without any registration and a different pair (3 &amp; 6) after registration. However, the ground truth revealed at the end of the summer school was that the actual pairs were: 2 &amp; 8, 1 &amp; 4 (we assessed correctly), 3 &amp; 6 (we assessed correctly), and 5 &amp; 7. Looking back at the results, without global registration, only 5 &amp; 7 could have been correctly paired using optimal transport. With global registration, 2 &amp; 8, 3 &amp; 6, and 5 &amp; 7 could have been correctly paired. It was interesting how we were able to pair 1 &amp; 4 visually while the optimal transport algorithm could not, yet it was able to pair 5 &amp; 7 and 2 &amp; 8 while we could not.</p> <h2 id="lessons-learned">Lessons learned</h2> <p>Since the sizes of the aortas changed over the different scan times, the use of just xyz-coordinates is difficult: scaling matters. In addition, the xyz-coordinates do not capture geometric areas of the aorta that may vary across patients, but not over time. Using features that capture the general shape of the point cloud or domain-specific features (for example, the radius of specific arteries attached to the aorta) may have led to better outcomes. If there was more data, specifying the 3D features might become less important, as neural networks can be used to learn a latent representation of the object. Finally, although I learned about the concept of optimal transport, which is an interesting approach to compare two distributions, I would have to dig deeper into it to better understand its limitations compared to other approaches. Of course, both understanding and implementation is a huge barrier when trying to apply these types of advanced methods to complex problems, which is why I was limited to trying things that could be extended from existing implementations.</p> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2025 Ananya Nandy. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@/dist/jquery.min.js" integrity="" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@/dist/umd/popper.min.js" integrity="" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@/dist/js/bootstrap.min.js" integrity="" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@/js/mdb.min.js" integrity="" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@/dist/masonry.pkgd.min.js" integrity="" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script src="https://cdn.jsdelivr.net/npm/medium-zoom@/dist/medium-zoom.min.js" integrity="" crossorigin="anonymous"></script> <script src="/assets/js/zoom.js"></script> <script src="/assets/js/common.js"></script> <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams'
      }
    };
  </script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>